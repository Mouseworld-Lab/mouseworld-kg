
######################
# BEANS
######################

- beans:
  - name: constructGraph
    type: "#class:com.cefriel.util.ChimeraResourceBean"
    properties:
      url: "file://./files/construct.txt"
      serializationFormat: "txt"
  - name: selectNodeQuery
    type: "#class:com.cefriel.util.ChimeraResourceBean"
    properties:
      url: "file://./files/select-node.txt"
      serializationFormat: "txt"
  - name: loweringMappingTemplate
    type: "#class:com.cefriel.util.ChimeraResourceBean"
    properties:
      url: "file://./files/mappings.vm"
      serializationFormat: "vtl"

######################
# ROUTES
######################

- from:
    id: connectGraph
    uri: "graph://get"
    parameters:
      serverUrl: http://127.0.0.1:7200
      repositoryId: default
      defaultGraph: true
    steps:
      - to:
          uri: "seda:getConfigGraph"

- from:
    id: getConfigGraph
    uri: "seda:getConfigGraph"
    steps:
      - to:
          uri: "graph://construct"
          parameters:
            newGraph: true
            chimeraResource: "#bean:constructGraph"

- from:
    id: lowering
    uri: "seda:lowering"
    steps:
      - to:
          uri: "mapt://rdf"
          parameters:
            template: "#bean:loweringMappingTemplate"
            query: "#bean:selectNodeQuery"
      - to:
          uri: "direct:storeConfig"

- from:
    id: storeConfig
    uri: "direct:storeConfig"
    steps:
      - toD:
          uri: "file:output"
          parameters:
            fileName: ${x.id}.conf
            noop: true
      - log:
          message: "Lowering has been generated and saved to output/${x.id}.conf"
