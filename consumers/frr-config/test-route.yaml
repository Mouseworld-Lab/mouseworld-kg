
######################
# BEANS
######################

- beans:
  - name: selectNodeQuery
    type: "#class:com.cefriel.util.ChimeraResourceBean"
    properties:
      url: "file://./files/select-node.txt"
      serializationFormat: "txt"
  - name: loweringMappingTemplate
    type: "#class:com.cefriel.util.ChimeraResourceBean"
    properties:
      url: "file://./files/mappings.vm"
      serializationFormat: "vtl"

######################
# ROUTES
######################

- from:
    uri: "file:input"
    parameters:
      fileName: "input.ttl"
      noop: true
    steps:
      - to:
          uri: "seda:lowering"

- from:
    id: lowering
    uri: "seda:lowering"
    steps:
      - to:
          uri: "mapt://rdf"
          parameters:
            template: "#bean:loweringMappingTemplate"
            query: "#bean:selectNodeQuery"
      - log:
          message: "Lowering ${body}"
      - to:
          uri: "seda:store"

- from:
    id: store
    uri: "seda:store"
    steps:
      - split:
          expression:
            simple: "${body}"
      - log:
          message: "Lowering key ${body.key}"
      - log:
          message: "Lowering value ${body.value}"
      - to:
          uri: "file:output"
          parameters:
            fileName: example.conf
            noop: true
      - log:
          message: "Lowering has been generated and saved to output/example.conf"

